<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Email Assistant Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .debug-button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .debug-button:hover {
            background-color: #1967d2;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .tone-selector {
            margin: 10px 0;
        }
        
        .tone-selector label {
            margin-right: 15px;
        }
    </style>
</head>

<body>
    <h1>AI Email Assistant Debug Tool</h1>

    <div class="debug-section">
        <h3>Manual Email Content Test</h3>
        <p>Enter email content manually to test the AI response generation:</p>
        <textarea id="emailContent" placeholder="Enter the email content you want to reply to...">Hi there,

I'm writing to follow up on our meeting last week about the project timeline. Could you please provide an update on the current status and let me know if there are any blockers we need to address?

Thanks,
John</textarea>

        <div class="tone-selector">
            <label><input type="radio" name="tone" value="Professional" checked> Professional</label>
            <label><input type="radio" name="tone" value="Casual"> Casual</label>
            <label><input type="radio" name="tone" value="Formal"> Formal</label>
        </div>

        <button class="debug-button" onclick="testManualContent()">Generate AI Reply</button>
        <div id="manual-result" class="result"></div>
    </div>

    <div class="debug-section">
        <h3>Backend Connection Test</h3>
        <button class="debug-button" onclick="testBackendConnection()">Test Backend</button>
        <button class="debug-button" onclick="testMultipleRequests()">Test Multiple Requests</button>
        <div id="backend-result" class="result"></div>
    </div>

    <div class="debug-section">
        <h3>Extension Storage Test</h3>
        <button class="debug-button" onclick="testStorage()">Test Storage</button>
        <button class="debug-button" onclick="clearStorage()">Clear Storage</button>
        <button class="debug-button" onclick="viewHistory()">View History</button>
        <div id="storage-result" class="result"></div>
    </div>

    <script>
        async function testManualContent() {
            const resultDiv = document.getElementById('manual-result');
            const emailContent = document.getElementById('emailContent').value;
            const tone = document.querySelector('input[name="tone"]:checked').value;

            if (!emailContent.trim()) {
                resultDiv.textContent = 'Please enter some email content first.';
                return;
            }

            resultDiv.textContent = `Generating reply for tone: ${tone}...`;

            try {
                const response = await fetch('http://3.90.38.82:8080/api/email/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    body: JSON.stringify({
                        emailBody: emailContent,
                        tone: tone,
                        timestamp: Date.now()
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                resultDiv.textContent = `✅ Generated reply (${tone} tone):\n\n${data.generatedResponse}\n\n---\n\nFull response:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testBackendConnection() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.textContent = 'Testing backend connection...';

            try {
                const response = await fetch('http://3.90.38.82:8080/api/email/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    body: JSON.stringify({
                        emailBody: "Test email for backend connection",
                        tone: "Professional",
                        timestamp: Date.now()
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                resultDiv.textContent = `✅ Backend is working!\n\nResponse:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Backend error: ${error.message}`;
            }
        }

        async function testMultipleRequests() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.textContent = 'Testing multiple requests...\n\n';

            const testEmails = [
                "Hi, can we schedule a meeting for next week?",
                "Thanks for the update on the project status.",
                "I have a question about the budget allocation.",
                "Please review the attached documents and let me know your thoughts."
            ];

            for (let i = 0; i < testEmails.length; i++) {
                const email = testEmails[i];
                resultDiv.textContent += `Request ${i + 1}: "${email}"\n`;

                try {
                    const response = await fetch('http://3.90.38.82:8080/api/email/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        },
                        body: JSON.stringify({
                            emailBody: email,
                            tone: "Professional",
                            timestamp: Date.now()
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    resultDiv.textContent += `Response: ${data.generatedResponse.substring(0, 100)}...\n\n`;
                } catch (error) {
                    resultDiv.textContent += `Error: ${error.message}\n\n`;
                }
            }
        }

        function testStorage() {
            const resultDiv = document.getElementById('storage-result');

            if (typeof chrome !== 'undefined' && chrome.storage) {
                chrome.storage.local.get('state', (result) => {
                    resultDiv.textContent = `✅ Storage is working!\n\nCurrent state:\n${JSON.stringify(result.state, null, 2)}`;
                });
            } else {
                resultDiv.textContent = '❌ Chrome storage not available (not running in extension context)';
            }
        }

        function clearStorage() {
            const resultDiv = document.getElementById('storage-result');

            if (typeof chrome !== 'undefined' && chrome.storage) {
                chrome.storage.local.clear(() => {
                    resultDiv.textContent = '✅ Storage cleared successfully!';
                });
            } else {
                resultDiv.textContent = '❌ Chrome storage not available';
            }
        }

        function viewHistory() {
            const resultDiv = document.getElementById('storage-result');

            if (typeof chrome !== 'undefined' && chrome.storage) {
                chrome.storage.local.get('state', (result) => {
                    const history = result.state ? .replyHistory || [];
                    if (history.length === 0) {
                        resultDiv.textContent = 'No reply history found.';
                    } else {
                        resultDiv.textContent = `Found ${history.length} history entries:\n\n`;
                        history.forEach((entry, index) => {
                            resultDiv.textContent += `Entry ${index + 1}:\n`;
                            resultDiv.textContent += `Subject: ${entry.subject}\n`;
                            resultDiv.textContent += `Tone: ${entry.tone}\n`;
                            resultDiv.textContent += `Original: ${entry.originalEmail.substring(0, 100)}...\n`;
                            resultDiv.textContent += `Reply: ${entry.generatedReply.substring(0, 100)}...\n\n`;
                        });
                    }
                });
            } else {
                resultDiv.textContent = '❌ Chrome storage not available';
            }
        }
    </script>
</body>

</html>